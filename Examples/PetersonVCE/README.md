### PetersonVCE
This is an example of a VCE project. It contains Peterson's leader election algorithm modeled in VCE. The modeled example includes future-based communications.
The project was created and tested with VCEv4 v.4.0.5 and Obeo Designer-community v.7.1.

##### Prerequisites
In order to test the project, you need Obeo Designer community 7.x (or Sirius) with VCEv4 installed on it.
All the installation details can be found here:
https://team.inria.fr/scale/software/vercors/vcev4-download/
Once you have everything installed, you can import PetersonVCE in your Obeo Designer workspace.

##### Project overview
The project contains:
* default.vce - the architecture of the modeled example
* default.uml - the UML classes, interfaces and State Machines 
* default. vcetypes - the types abstractions
* "cadp" folder - includes the files generated by VCEv4 for Model-checking; the queue size is 2 for all components
* "le" folder and Application.fractal - executable Java code and ADL file of the modeled example. The code can be run on ProActive platform.

The executable Java code generated from VCEv4 was already integrated to [PetersonPA](https://github.com/Scale-VerCors/VCEv4/tree/master/Examples/PetersonPA) ProActive-based project. However, you can regenerate it by following the instructions below. We also provide the information on how to regenerate files for Model-checking below. For more instructions on how to use VCE, please, follow our [Tutorial](https://github.com/Scale-VerCors/VCEv4/blob/master/VCEv4_tutorial/vce_v4_tutorial.pdf).

##### Generate executable code
* delete Application.fractal file and "le" folder from the project;
* right-click on default.vce file and select "Export... -> VCE Export -> ADL Export" and press "Next";
* select default.vce, default.uml and default.vcetypes files in the right pannel of the wizard and press "next";
* specify the File name: "Application.fractal" (it should strictly correspond to the name of the root composite). 
* specify the package name: "le" (you can choose any name for the package. We suggest "le" if you would like to test the code with PetersonPA project);
* press "Finish"

In order to test the generated files with ProActive you can copy "le" folder and Application.fractal file to "src" folder of [PetersonPA](https://github.com/Scale-VerCors/VCEv4/tree/master/Examples/PetersonPA) project and launch it.

##### Generate files for model-checking
* in the Model Explorer click-twice on "default.vce -> Architecture -> VCE diagram" in order to open Components diagram of the example;
* right-clich on the membrane (grey part) of Application component and select "Generate pNet -> Generate pNet". This will open a Wizard;
* select "<State Machine> Scenario - this is a State Machine modeling the scenario of the environment; press "Next";
* specify the queue sizes of the components (for example, 2) and press "next";
* specify the communications that you do not want to observe during model-checking (in our example we hide only "Server operations and queue -> runPeterson" which means that the Application can accept runPeterson method invocation only from the Scenario; press "Finish". The wizard was created for the debugging purposes and it was not properly tested yet.

This will generate "cadp" folder in your project. The folder includes Fiacre files of all pLTSs, EXP files with synchronization vectors for all components, SVL scripts hiding internal communications. Finally, run.sh file contains a script that launches SVL scripts and invokes Flac compiler in order to generate BCG files of the components. You should add the flac-and-minimize script from our Examples folder to your forlder with run.sh.
In order to get information on how to install and use CADP model-checker, please, check the [official web-site of CADP](http://cadp.inria.fr/).





